name: ax3000t.yml
on:
  workflow_dispatch:
  schedule:
    - cron: '0 0 * * *'
jobs:
  build_ax3000t:
    runs-on: ubuntu-24.04
    steps:
      - name: setup env
        run: |
          sudo apt update
          sudo apt install -y build-essential clang flex bison g++ gawk \
          gcc-multilib g++-multilib gettext git libncurses5-dev libssl-dev \
          python3-setuptools rsync swig unzip zlib1g-dev file wget zstd
      - name: clone source
        run: |
          wget https://downloads.openwrt.org/snapshots/targets/mediatek/filogic/openwrt-sdk-mediatek-filogic_gcc-13.3.0_musl.Linux-x86_64.tar.zst
          zstd -d openwrt-sdk-mediatek-filogic_gcc-13.3.0_musl.Linux-x86_64.tar.zst
          tar -Jxvf openwrt-sdk-mediatek-filogic_gcc-13.3.0_musl.Linux-x86_64.tar
          mv 13257323077 immortalwrt
      - name: build
        run: |
          cd immortalwrt
          ./scripts/feeds update -a
          ./scripts/feeds install -a
          make defconfig
          make download -j$(nproc)
          make -j$(nproc)
      - name: Release
        uses: softprops/action-gh-release@v2
        with:
          files: |
            ./bin/packages/**/*.ipk
